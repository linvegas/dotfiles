#!/usr/bin/env sh

mor() {
  MOR_DIR="/mnt/ssd/morbus/pic"
  [ ! -d "$MOR_DIR" ] && notify-send "${MOR_DIR} não existe" && exit 1
  folder=$(\
    find "$MOR_DIR" -maxdepth 1 -mindepth 1 -exec basename '{}' \; |\
    dmenu -l 20 -p "Escolha a pasta: "
  )
  if [ ! -d "${MOR_DIR}/${folder}" ]; then
    newfolder="$(printf "Sim\nnão" | dmenu -p "Criar a pasta ${folder}?")"
    case $newfolder in
      "Sim"|"sim"|"s"|"y") mkdir -p "${MOR_DIR}/${folder}";;
      *) exit 1;;
    esac
  fi
  newname=$(\
    find "${MOR_DIR}/${folder}" -maxdepth 1 -mindepth 1 -exec basename '{}' \; |\
    sort -r |\
    dmenu -l 20 -p "Renomear ${1} para: "
  )
  [ -z "$newname" ] && exit
  newpath="${MOR_DIR}/${folder}/${newname}"
  cp "$1" "$newpath" && notify-send "Sxiv" "Esse arquivo foi copiado em \n$newpath"
}

while read -r file; do
  case "$1" in
    "i") notify-send "Info" "$(file "$file")";;
    "m") mor "$file";;
  esac
done
