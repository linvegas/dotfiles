#!/usr/bin/env sh

# Some global variables
ANI_DIR="/mnt/ssd/anime"
FIND_OPTS="-maxdepth 1 -mindepth 1"
MPV="mpv --fs"

# Check if anime path exists
[[ ! -d "$ANI_DIR" ]] && echo "O diretório ${ANI_DIR} não existe." && exit 0

# Selecting anime's folder
ANI_PATH=$(
  find "${ANI_DIR}" ${FIND_OPTS} -type d -exec basename '{}' \; |
  rofi -dmenu
)

# Check if options were selected
[[ -z "${ANI_PATH}" ]] && exit 0

# Selecting anime's episode
ANI_EPI=$(
  find "${ANI_DIR}/${ANI_PATH}" ${FIND_OPTS} \
  -type f \( -name "*.mkv" -or -name "*.mp4" -or -name "*.webm" \) \
  -exec basename '{}' \; |
  sort |
  rofi -dmenu
)

# Check if options were selected
[[ -z "${ANI_EPI}" ]] && exit 0

# Actually playing the anime
$MPV "${ANI_DIR}/${ANI_PATH}/${ANI_EPI}"
