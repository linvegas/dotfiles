#!/usr/bin/env bash
# Depends on: xwallpaper, xorg-xrandr and pywal

# Wallpapers directorie
wp_dir="$HOME/media/pic/wallpaper"
[ ! "$(find "$wp_dir" -maxdepth 1 -mindepth 1)" ] && wp_dir="/usr/share/backgrounds/archlinux"

# Set image from argument or default directory
case "$1" in
  "") image=$(find "$wp_dir" -type f \( -name \*.jpg -o -name \*.png \)| shuf -n 1);;
  *)  image=$(readlink -f "$1");;
esac

# Pywal
[ "$(which wal)" ] && wal -n -s -q -i "$image"

# Get monitors connected
monitors=$(xrandr -q | grep -e '\sconnected' | cut -d ' ' -f1)
count=$(xrandr -q | grep -e '\sconnected' | cut -d ' ' -f1 | wc -l)

# If there is only one monitor connected
[ "$count" = 1 ] && \
  xwallpaper --output "$monitors" --stretch "$image" && exit

# Dual monitor setup
for m in $monitors; do
  if [[ "$m" =~ "HDMI" ]]; then
    xwallpaper --output "$m" --stretch "$image"

  else
    xwallpaper --output "$m" --zoom "$image"
  fi
done
